# Отчет по аудиту проекта AI Solutions Website

**Дата:** 28 октября 2025  
**Цель:** Оптимизация и очистка кодовой базы для снижения размера бандла на 15-30%

## 1. Анализ зависимостей

### ✅ Используемые зависимости (оставить)

**UI библиотеки:**
- `@radix-ui/*` - 33 компонента активно используются ✓
- `lucide-react` - иконки используются по всему проекту ✓
- `recharts` - используется в chart.tsx ✓
- `vaul` - используется в drawer.tsx ✓
- `sonner` - используется в sonner.tsx ✓
- `cmdk` - используется в command.tsx ✓
- `input-otp` - используется в input-otp.tsx ✓

**Core зависимости:**
- `next` 14.2.16 ✓
- `react` 18.3.1 ✓
- `react-dom` 18.3.1 ✓
- `tailwindcss` 4.1.9 ✓
- `typescript` 5.x ✓

**Утилиты:**
- `clsx`, `tailwind-merge` - для условных классов ✓
- `class-variance-authority` - для вариантов компонентов ✓
- `zod` - валидация форм ✓
- `react-hook-form` - управление формами ✓
- `date-fns` - работа с датами ✓

**Мониторинг:**
- `@vercel/analytics` ✓
- `@opentelemetry/*` - полный стек для трейсинга ✓
- `pino` - логирование ✓
- `ioredis` - Redis клиент ✓

### ❌ Неиспользуемые зависимости (удалить)

1. **embla-carousel-react** - 0 использований
2. **tw-animate-css** - 0 использований (есть tailwindcss-animate)
3. **node-notifier** - 0 использований
4. **path** - встроенный модуль Node.js, не нужен в dependencies
5. **openapi-types** - 0 использований
6. **@vitest/browser-*** - 3 пакета для browser testing, но не используются
7. **@testing-library/dom** - дублирует @testing-library/react

### ⚠️ Проблемные зависимости

1. **Использование "latest"** - 40+ пакетов с версией "latest":
   - Риск: непредсказуемые обновления
   - Рекомендация: зафиксировать версии

2. **@jest/globals** - установлен, но проект использует Vitest
   - Рекомендация: удалить если не используется

## 2. Анализ UI компонентов

### Активно используемые компоненты:
- ✅ **button** - 50+ использований
- ✅ **card** - 50+ использований  
- ✅ **badge** - 40+ использований
- ✅ **input** - 10+ использований
- ✅ **textarea** - 5+ использований
- ✅ **tabs** - 5+ использований
- ✅ **accordion** - 5+ использований
- ✅ **checkbox** - 2 использования
- ✅ **label** - 2 использования
- ✅ **slider** - 1 использование
- ✅ **select** - 1 использование
- ✅ **toaster** - 1 использование (в layout)

### Потенциально неиспользуемые компоненты (требуется проверка):
- alert-dialog
- aspect-ratio
- avatar
- breadcrumb
- chart
- collapsible
- command
- context-menu
- dialog
- drawer
- dropdown-menu
- form
- hover-card
- input-otp
- menubar
- navigation-menu
- popover
- progress
- radio-group
- resizable
- scroll-area
- separator
- sheet
- sidebar
- sonner
- switch
- toggle
- toggle-group
- tooltip

**Примечание:** Эти компоненты могут использоваться динамически или в клиентских компонентах. Требуется дополнительная проверка перед удалением.

## 3. Конфигурация

### ✅ Исправлено:
- Включен `noUnusedLocals` и `noUnusedParameters` в tsconfig.json
- Включен `optimizeCss` в next.config.mjs
- Добавлен `minimumCacheTTL` для оптимизации изображений

### ⚠️ Требует внимания:
- `ignoreBuildErrors: true` - отключает проверку ошибок TypeScript при сборке
- `ignoreDuringBuilds: true` - отключает проверку ESLint при сборке
- Рекомендация: включить после исправления всех ошибок

## 4. Рекомендации по оптимизации

### Приоритет 1: Удаление неиспользуемых зависимостей
\`\`\`bash
pnpm remove embla-carousel-react tw-animate-css node-notifier path openapi-types @vitest/browser-playwright @vitest/browser-preview @vitest/browser-webdriverio @testing-library/dom
\`\`\`

**Ожидаемый эффект:** Снижение размера node_modules на ~50MB, уменьшение времени установки на 10-15%

### Приоритет 2: Фиксация версий зависимостей
Заменить все "latest" на конкретные версии для предсказуемости сборок.

### Приоритет 3: Динамические импорты
Добавить динамические импорты для тяжелых компонентов:
- Tabs компоненты (используются только на некоторых страницах)
- Accordion компоненты
- Chart компоненты
- Form компоненты

**Ожидаемый эффект:** Снижение initial bundle на 20-30KB

### Приоритет 4: Оптимизация изображений
- Все изображения уже используют Next.js Image
- Добавлен `minimumCacheTTL: 60` для кэширования
- Рекомендация: конвертировать все изображения в WebP/AVIF

### Приоритет 5: Code splitting
Разделить большие страницы на более мелкие компоненты с динамической загрузкой.

## 5. Метрики (baseline)

### Текущее состояние:
- **Total dependencies:** 70+ пакетов
- **Dev dependencies:** 25+ пакетов
- **UI components:** 50+ компонентов
- **Build time:** TBD (требуется замер)
- **Bundle size:** TBD (требуется замер с bundle analyzer)

### Целевые метрики после оптимизации:
- **Total dependencies:** ~60 пакетов (-15%)
- **Unused UI components removed:** TBD
- **Bundle size reduction:** -15-30%
- **Build time improvement:** -10-20%

## 6. План действий

### Фаза 1: Безопасная очистка (текущая)
- [x] Аудит зависимостей
- [x] Исправление конфигурации
- [ ] Удаление неиспользуемых зависимостей
- [ ] Фиксация версий

### Фаза 2: Оптимизация бандла
- [ ] Добавление bundle analyzer
- [ ] Динамические импорты для тяжелых компонентов
- [ ] Оптимизация изображений
- [ ] Code splitting

### Фаза 3: Тестирование
- [ ] E2E тесты критических путей
- [ ] Lighthouse аудит
- [ ] Сравнение метрик до/после

### Фаза 4: Документация
- [ ] Обновление README
- [ ] Документация по архитектуре
- [ ] Rollback план

## 7. Риски и митигация

### Риск 1: Удаление используемых зависимостей
**Митигация:** Тщательная проверка перед удалением, полное тестирование после

### Риск 2: Breaking changes при фиксации версий
**Митигация:** Постепенное обновление, тестирование каждого изменения

### Риск 3: Регрессия функциональности
**Митигация:** E2E тесты, ручное тестирование критических путей

## 8. Следующие шаги

1. **Немедленно:** Удалить неиспользуемые зависимости
2. **Сегодня:** Добавить bundle analyzer и замерить baseline метрики
3. **На этой неделе:** Внедрить динамические импорты
4. **В следующем спринте:** Полная оптимизация и тестирование
